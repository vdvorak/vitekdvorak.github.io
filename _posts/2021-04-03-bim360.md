---
layout: post
title: "BIM 360"
date: 2021-04-03 00:00:00 +0000
tags: BIM360
---

My last task in [Navigo3](https://navigo3.com/) was to find the way, how to integrate BIM.
We decided to work with BIM based software from [Autodesk](https://www.autodesk.com/) [BIM 360](https://www.autodesk.com/bim-360/).

## Basic implementation structure
![BIM 360 demo diagram](/assets/img/bim360-demo-diagram.PNG)
    
## What is ?
 - Admin account - Account with demo of BIM 360 mostly owned by company ([Sign in](https://admin.b360.autodesk.com))
 - Account of employee - Basic autodesk account assigned to some project ([Sign in]((https://www.autodesk.com/)))
 - Client app - Basic representation of identity of your app ([Sign in](https://forge.autodesk.com/))
 - Callback url - When is user authenticated for the first time after allowing he will be redirected to this url with authentication code
 - refresh token - Allows you to get new **Access token** without bothering the user

## Building testing enviroment
   1. **Create accounts at [Autodesk](https://www.autodesk.com/) for**
      - Your client (**OurCompany**)
      - Client of your client (**OtherCompany**)
      - Employee of your company (**OurEmployee**)
      - Your application (**App**)
  2. **Create client app**
      1. Sign in at [Autodesk forge](https://forge.autodesk.com/)  with App account
      2. Go to my apps
      3. Create new app
      4. Set app name and callback url
  3. **Request BIM 360 demo at [BIM 360 demo](https://www.autodesk.com/bim-360/start-for-free/) for OurCompany and OtherCompany** - Establishing demo takses some time
  4. **Prepare projec for OurCompany and OtherCompany**
      1. Sign in at [BIM 360 admin](https://admin.b360.autodesk.com)  
      2. Create your testing project
      3. Click on project in projects list
      4. On the page you have been redirected to click to "Add member" and fill email with email of OurEmployee
  5. **Connect your client app with OurCompany and OtherCompany**
       1. Sign in at [BIM 360 admin](https://admin.b360.autodesk.com)  
       2. Go to settings
       3. Open Custom integrations
       4. Create new custom integration
           1. Select only "Document Management"
           2. Select "I am developer"
           3. Go to app you have created in step 2 and copy client id to fill dialog window
           4. Type some name of integration and click save 

## BIM 360 Authentication
   To read any data of project you have to go through "Three-legged authentication"
### Step by step
   1. **Getting access token with users attention (First authentization or missing refresh token)**
        1. **Getting authentication code**
            - **Usage:** Thanks to refresh token this step is required only once at the beging, placed for example on some button
            - **URL:** "https://developer.api.autodesk.com/authentication/v1/authorize?response_type=[reposnse_type]&client_id]=[clientID]&redirect_uri=[callback url]&scope=[scope]" 
            - **Parameters:**
                - Client id (in your [Forge App](https://forge.autodesk.com/))
                - Client secret
                - Client callback url (redirect_uri)
                - Type of response (**response_type**=code)
            - Access privilegs you want to get from user (**scope**=data:read)
            - **What will hapen:**
                1. User will be redirected to autodesk authentication page
                2. After users signs in he well be asked to grant privilegs to your app
                3. When user allows app access he will be redirected to your callback url with authentication code in url parameter
        2. **Getting access token**
              - **Usage:** This token is used to authentize your app when you requesting data
              - **URL:** "[https://developer.api.autodesk.com/authentication/v1/gettoken](https://developer.api.autodesk.com/authentication/v1/gettoken)"
              - **Headers:** "Content-Type: application/x-www-form-urlencoded"
              - **Method:** "POST"
              - **Parameters:**
                   - client_id (in your [Forge App](https://forge.autodesk.com/))
                   - client_secret
                   - Client callback url (redirect_uri)
                   - Type of authorzation(**grant_type**=code)
                   -  Authentization code retrieved from previous request
              - **What will hapen:** After submiting request server sends response including "Access token" and "Refresh token"
  2. **Getting access token with refresh token**
        - **Usage:** This token is used to authentize your app when you requesting data
        - **URL:** "[https://developer.api.autodesk.com/authentication/v1/refreshtoken](https://developer.api.autodesk.com/authentication/v1/refreshtoken)"
        - **Headers:** "Content-Type: application/x-www-form-urlencoded"
        - **Method:** "POST"
        - **Parameters:**
             - client_id (in your [Forge App](https://forge.autodesk.com/))
             - client_secret
             - Type of authorzation (**grant_type**=refresh_token)
             - Refresh token you have stored
        - **What will hapen:** After submiting request server sends response including "Access token" and "Refresh token"  
 
 
**More details at [BIM 360 API](https://forge.autodesk.com/en/docs/bim360/v1/overview/introduction/)**

           
